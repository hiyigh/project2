<!doctype html>
<html lang="ko" xmlns:th="www.thymeleaf.org">
<head>
    <div th:replace="~{fragments/head.html::meta}"></div>
    <title>Home</title>
</head>
<body>
<header th:replace="~{fragments/header.html::header}"></header>
    <section>
        <p>Home</p>
    </section>
    <section>
        <div class="imageShow"></div>

        <form method="post" enctype="multipart/form-data">
            <div class="button">
                <label for="chooseFile">
                    Click Here
                </label>
                <input type="file" id="chooseFile" name="chooseFile" multiple accept="image/*" onchange="loadFile()" />
            </div>
            <div class="fileContainer">

                <div class="fileInput">
                    <p>FILE NAME: </p>
                    <p id="fileName"></p>
                </div>

                <div class="buttonContainer">
                    <div class="submitButton" id="submitButton" onclick="saveFile()">SUBMIT</div>
                </div>
            </div>
        </form>
    </section>
<footer th:replace="~{fragments/footer.html::footer}"></footer>
</body>
<script>

    function saveFile(){
        let fileInput = document.querySelector('#chooseFile');
        let fileList = fileInput.files;
        let formData = new FormData();

        for (let i = 0; i < fileList.length; i++) {
            formData.append('image[]', fileList[i]);
        }

        $.ajax({
            type:'post',
            url:'/home/api/saveImage',
            processData:false,
            contentType:false,
            data:formData,
            success:function(){
                alert('save file');
            },
            error:function(error){
                alert('fail to save file', error);
            }
        });
    }

    function loadFile() {
    <!-- this 전달 값은 input 요소 -->
    <!-- filesList.value 는 실패-->
        let resetImg = document.querySelector('.imageShow');
        let resetFileName = document.querySelector('#fileName');
        resetImg.textContent = '';
        resetFileName.textContent = '';

        let fileInput = document.querySelector('#chooseFile');
        let files = fileInput.files;
        let fileName = document.querySelector('#fileName');
        let display = document.querySelector('.imageShow');

        let formData = new FormData();

        for (let i = 0; i < files.length; ++i){
            formData.append('image[]', files[i]);
        }
        let images = formData.getAll('image[]');

        for (let i = 0; i < files.length;++i){
            fileName.textContent += files[i].name + ' ';

            let newImage = document.createElement('img');
            newImage.setAttribute('class' , 'newImage');

            newImage.src = URL.createObjectURL(images[i]);
            display.appendChild(newImage);
        }
    }

</script>
</html>